{% extends "base.html" %}

{% block content %}
<section class="panel">
    <div class="panel-header">
        <h1>MealBot</h1>
        <p>Browse curated dinner ideas and save your favorites to cook later.</p>
    </div>
    <div class="panel-body recipes-layout">
        <div class="card">
            <h2>Recipes</h2>
            <p class="small">We show a mix of recipes from different cuisines. Your pantry is used to highlight what you already have and what you need.</p>

            {% if items %}
            <div class="chip-list">
                <p class="small">In your pantry now:</p>
                <div class="chips">
                    {% for item in items %}
                    <span class="chip">
                        {{ item.name }}
                        {% if item.quantity %} ¬∑ {{ item.quantity }}{% endif %}
                        {% if item.unit %} {{ item.unit }}{% endif %}
                    </span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <div class="recipes-scroll">
                {% if recipes %}
                    {% for r in recipes %}
                    <article class="recipe-card">
                        <div class="recipe-main">
                            <div class="recipe-thumb">üçΩÔ∏è</div>
                            <div class="recipe-text">
                                <h3>{{ r.title }}</h3>
                                {% if r.description %}
                                <p class="muted small">{{ r.description }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="recipe-meta">
                            {% if r.have %}
                            <span class="pill pill-have">{{ r.have|length }} you have</span>
                            {% endif %}
                            {% if r.missing %}
                            <span class="pill pill-missing">{{ r.missing|length }} to buy</span>
                            {% endif %}
                        </div>
                        <details class="recipe-details">
                            <summary>View full recipe</summary>
                            <h4>Ingredients</h4>
                            <ul class="list">
                                {% for line in r.ingredients %}
                                <li>{{ line }}</li>
                                {% endfor %}
                            </ul>
                            <h4>Steps</h4>
                            <ol class="list">
                                {% for step in r.steps %}
                                <li>{{ step }}</li>
                                {% endfor %}
                            </ol>
                            {% if r.have or r.missing %}
                            <div class="have-missing">
                                {% if r.have %}
                                <div>
                                    <p class="small muted">You already have:</p>
                                    <ul class="list">
                                        {% for line in r.have %}
                                        <li>{{ line }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                {% endif %}
                                {% if r.missing %}
                                <div>
                                    <p class="small muted">You still need:</p>
                                    <ul class="list">
                                        {% for line in r.missing %}
                                        <li>{{ line }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}
                        </details>
                        <form method="post" action="{{url_for('save_recipe')}}" class="save-form">
                            <input type="hidden" name="title" value="{{ r.title }}">
                            <input type="hidden" name="description" value="{{ r.description }}">
                            <input type="hidden" name="ingredients" value="{{ r.ingredients|join('\n') }}">
                            <input type="hidden" name="steps" value="{{ r.steps|join('\n') }}">
                            <button type="submit" class="btn primary">Add to To-Cook List</button>
                        </form>
                    </article>
                    {% endfor %}
                {% else %}
                    <p class="empty">No recipes found.</p>
                {% endif %}
            </div>
        </div>

        <div class="card">
            <h2>To-Cook List</h2>
            <div class="tocook-scroll">
                {% if to_cook %}
                <ul class="tocook-list">
                    {% for entry in to_cook %}
                    <li class="tocook-item">
                        <div class="tocook-main">
                            <div class="tocook-title">{{ entry.title }}</div>
                            {% if entry.description %}
                            <div class="tocook-desc">{{ entry.description }}</div>
                            {% endif %}
                        </div>
                        <form method="post" action="{{url_for('delete_saved_recipe', item_id=entry.id)}}">
                            <button type="submit" class="btn ghost small-btn">Remove</button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="empty">No saved recipes yet. Add some from the left.</p>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}